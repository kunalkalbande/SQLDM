package com.idera.sqldm.ui.dashboard.instances.queries;

import java.io.StringReader;
import java.io.StringWriter;
import java.io.Writer;

import javax.xml.parsers.DocumentBuilderFactory;

import org.apache.commons.lang.StringEscapeUtils;
import org.apache.log4j.Logger;
import org.w3c.dom.Node;
import org.w3c.dom.bootstrap.DOMImplementationRegistry;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSOutput;
import org.w3c.dom.ls.LSSerializer;
import org.xml.sax.InputSource;
import org.zkoss.codemirror.Codemirror;
import org.zkoss.util.media.AMedia;
import org.zkoss.zhtml.Filedownload;
import org.zkoss.zk.ui.Sessions;
import org.zkoss.zk.ui.select.SelectorComposer;
import org.zkoss.zk.ui.select.annotation.Listen;
import org.zkoss.zk.ui.select.annotation.Wire;
import org.zkoss.zul.Div;
import org.zkoss.zul.Label;

import com.idera.server.web.ELFunctions;
import com.idera.sqldm.i18n.SQLdmI18NStrings;

@SuppressWarnings("rawtypes")
public class QueryXMLPlan extends SelectorComposer<Div> {

	private final Logger log = Logger.getLogger(QueryXMLPlan.class);

	@Wire
	private Codemirror code;

	private String xmlPlan;

	@SuppressWarnings("unchecked")
	@Override
	public void doAfterCompose(Div comp) throws Exception {
		super.doAfterCompose(comp);

		xmlPlan = (String) Sessions.getCurrent().getAttribute("XmlPlanString");

		// xmlPlan =
		// "&lt;ShowPlanXML xmlns=&quot;http://schemas.microsoft.com/sqlserver/2004/07/showplan&quot; Version=&quot;1.2&quot; Build=&quot;11.0.2218.0&quot;&gt;&lt;BatchSequence&gt;&lt;Batch&gt;&lt;Statements&gt;&lt;StmtSimple StatementSubTreeCost=&quot;0.295245&quot; StatementEstRows=&quot;503.703&quot; StatementOptmLevel=&quot;FULL&quot; QueryHash=&quot;0xE6C6E27278148BBD&quot; QueryPlanHash=&quot;0xC702D5F2AB014A72&quot; StatementOptmEarlyAbortReason=&quot;GoodEnoughPlanFound&quot;&gt;&lt;QueryPlan DegreeOfParallelism=&quot;0&quot; MemoryGrant=&quot;1024&quot; NonParallelPlanReason=&quot;CouldNotGenerateValidParallelPlan&quot; CachedPlanSize=&quot;96&quot; CompileTime=&quot;29&quot; CompileCPU=&quot;29&quot; CompileMemory=&quot;1728&quot;&gt;&lt;Warnings&gt;&lt;PlanAffectingConvert ConvertIssue=&quot;Cardinality Estimate&quot; Expression=&quot;CONVERT_IMPLICIT(nchar(2),[o].[type],0)&quot;/&gt;&lt;/Warnings&gt;&lt;MemoryGrantInfo SerialRequiredMemory=&quot;512&quot; SerialDesiredMemory=&quot;768&quot; RequiredMemory=&quot;512&quot; DesiredMemory=&quot;768&quot; RequestedMemory=&quot;1024&quot; GrantWaitTime=&quot;0&quot; GrantedMemory=&quot;1024&quot; MaxUsedMemory=&quot;208&quot;/&gt;&lt;OptimizerHardwareDependentProperties EstimatedAvailableMemoryGrant=&quot;101615&quot; EstimatedPagesCached=&quot;3679&quot; EstimatedAvailableDegreeOfParallelism=&quot;2&quot;/&gt;&lt;RelOp NodeId=&quot;0&quot; PhysicalOp=&quot;Sort&quot; LogicalOp=&quot;Sort&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0.0112613&quot; EstimateCPU=&quot;0.00715367&quot; AvgRowSize=&quot;196&quot; EstimatedTotalSubtreeCost=&quot;0.295245&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1043&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1045&quot;/&gt;&lt;/OutputList&gt;&lt;MemoryFractions Input=&quot;1&quot; Output=&quot;1&quot;/&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualRebinds=&quot;1&quot; ActualRewinds=&quot;0&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Sort Distinct=&quot;0&quot;&gt;&lt;OrderBy&gt;&lt;OrderByColumn Ascending=&quot;1&quot;&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;/OrderByColumn&gt;&lt;OrderByColumn Ascending=&quot;1&quot;&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;/OrderByColumn&gt;&lt;/OrderBy&gt;&lt;RelOp NodeId=&quot;1&quot; PhysicalOp=&quot;Compute Scalar&quot; LogicalOp=&quot;Compute Scalar&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;5.03703e-005&quot; AvgRowSize=&quot;196&quot; EstimatedTotalSubtreeCost=&quot;0.27683&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1043&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1045&quot;/&gt;&lt;/OutputList&gt;&lt;ComputeScalar&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1043&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;CONVERT(bit,CASE WHEN [Expr1052]=(1) THEN (1) ELSE CASE WHEN [SQLdmDatabase].[sys].[sysxprops].[id] as [p].[id] IS NOT NULL THEN (1) ELSE (0) END END,0)&quot;&gt;&lt;Convert DataType=&quot;bit&quot; Style=&quot;0&quot; Implicit=&quot;0&quot;&gt;&lt;ScalarOperator&gt;&lt;IF&gt;&lt;Condition&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Condition&gt;&lt;Then&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Then&gt;&lt;Else&gt;&lt;ScalarOperator&gt;&lt;IF&gt;&lt;Condition&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;IS NOT&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;NULL&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Condition&gt;&lt;Then&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Then&gt;&lt;Else&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(0)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Else&gt;&lt;/IF&gt;&lt;/ScalarOperator&gt;&lt;/Else&gt;&lt;/IF&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1045&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;CONVERT(bit,CASE WHEN isnull([Expr1013],[Expr1029]) IS NULL THEN (1) ELSE (0) END,0)&quot;&gt;&lt;Convert DataType=&quot;bit&quot; Style=&quot;0&quot; Implicit=&quot;0&quot;&gt;&lt;ScalarOperator&gt;&lt;IF&gt;&lt;Condition&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;IS&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;isnull&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;Expr1029&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;NULL&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Condition&gt;&lt;Then&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Then&gt;&lt;Else&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(0)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Else&gt;&lt;/IF&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;RelOp NodeId=&quot;2&quot; PhysicalOp=&quot;Nested Loops&quot; LogicalOp=&quot;Left Outer Join&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.00210548&quot; AvgRowSize=&quot;8252&quot; EstimatedTotalSubtreeCost=&quot;0.27678&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1029&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;NestedLoops Optimized=&quot;0&quot;&gt;&lt;PassThru&gt;&lt;ScalarOperator ScalarString=&quot;[Expr1052]=(1)&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/PassThru&gt;&lt;OuterReferences&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/OuterReferences&gt;&lt;RelOp NodeId=&quot;3&quot; PhysicalOp=&quot;Merge Join&quot; LogicalOp=&quot;Left Outer Join&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0117649&quot; AvgRowSize=&quot;8248&quot; EstimatedTotalSubtreeCost=&quot;0.191219&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1029&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Merge ManyToMany=&quot;0&quot;&gt;&lt;InnerSideJoinColumns&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/InnerSideJoinColumns&gt;&lt;OuterSideJoinColumns&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/OuterSideJoinColumns&gt;&lt;Residual&gt;&lt;ScalarOperator ScalarString=&quot;[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id]=[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id]&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Residual&gt;&lt;RelOp NodeId=&quot;4&quot; PhysicalOp=&quot;Merge Join&quot; LogicalOp=&quot;Left Outer Join&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0119863&quot; AvgRowSize=&quot;4222&quot; EstimatedTotalSubtreeCost=&quot;0.125186&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Merge ManyToMany=&quot;0&quot;&gt;&lt;InnerSideJoinColumns&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/InnerSideJoinColumns&gt;&lt;OuterSideJoinColumns&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/OuterSideJoinColumns&gt;&lt;Residual&gt;&lt;ScalarOperator ScalarString=&quot;[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id]=[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id]&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Residual&gt;&lt;RelOp NodeId=&quot;5&quot; PhysicalOp=&quot;Filter&quot; LogicalOp=&quot;Filter&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.00599742&quot; AvgRowSize=&quot;196&quot; EstimatedTotalSubtreeCost=&quot;0.050692&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Filter StartupExpression=&quot;0&quot;&gt;&lt;RelOp NodeId=&quot;6&quot; PhysicalOp=&quot;Compute Scalar&quot; LogicalOp=&quot;Compute Scalar&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0003029&quot; AvgRowSize=&quot;200&quot; EstimatedTotalSubtreeCost=&quot;0.0446946&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;/OutputList&gt;&lt;ComputeScalar&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1037&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;schema_name([SQLdmDatabase].[sys].[sysschobjs].[nsid] as [o].[nsid])&quot;&gt;&lt;Intrinsic FunctionName=&quot;schema_name&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsid&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1044&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;CASE WHEN CONVERT_IMPLICIT(nchar(2),[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type],0)=N&#39;P&#39; THEN (1) ELSE CASE WHEN CONVERT_IMPLICIT(nchar(2),[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type],0)=N&#39;PC&#39; THEN (2) ELSE (1) END END&quot;&gt;&lt;IF&gt;&lt;Condition&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nchar&quot; Length=&quot;4&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;N&#39;P&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Condition&gt;&lt;Then&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Then&gt;&lt;Else&gt;&lt;ScalarOperator&gt;&lt;IF&gt;&lt;Condition&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nchar&quot; Length=&quot;4&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;N&#39;PC&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Condition&gt;&lt;Then&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(2)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Then&gt;&lt;Else&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Else&gt;&lt;/IF&gt;&lt;/ScalarOperator&gt;&lt;/Else&gt;&lt;/IF&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1052&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;CONVERT(bit,[SQLdmDatabase].[sys].[sysschobjs].[status] as [o].[status]&amp;amp;(1),0)&quot;&gt;&lt;Convert DataType=&quot;bit&quot; Style=&quot;0&quot; Implicit=&quot;0&quot;&gt;&lt;ScalarOperator&gt;&lt;Arithmetic Operation=&quot;BIT_AND&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;status&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Arithmetic&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;RelOp NodeId=&quot;7&quot; PhysicalOp=&quot;Clustered Index Scan&quot; LogicalOp=&quot;Clustered Index Scan&quot; EstimateRows=&quot;503.703&quot; EstimateIO=&quot;0.0409028&quot; EstimateCPU=&quot;0.0034889&quot; AvgRowSize=&quot;71&quot; EstimatedTotalSubtreeCost=&quot;0.0443917&quot; TableCardinality=&quot;3029&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsid&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;status&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1803&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;IndexScan Ordered=&quot;1&quot; ScanDirection=&quot;FORWARD&quot; ForcedIndex=&quot;0&quot; ForceSeek=&quot;0&quot; ForceScan=&quot;0&quot; NoExpandHint=&quot;0&quot; Storage=&quot;RowStore&quot;&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;name&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsid&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;status&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;Object Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Index=&quot;[clst]&quot; Alias=&quot;[o]&quot; TableReferenceId=&quot;1&quot; IndexKind=&quot;Clustered&quot;/&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;CONVERT_IMPLICIT(nchar(2),[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type],0)=CONVERT_IMPLICIT(nvarchar(4000),[@_msparam_0],0) OR CONVERT_IMPLICIT(nchar(2),[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type],0)=CONVERT_IMPLICIT(nvarchar(4000),[@_msparam_1],0) OR CONVERT_IMPLICIT(nchar(2),[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type],0)=CONVERT_IMPLICIT(nvarchar(4000),[@_msparam_2],0)&quot;&gt;&lt;Logical Operation=&quot;OR&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nchar&quot; Length=&quot;4&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;ConstExpr1046&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nvarchar&quot; Length=&quot;8000&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;@_msparam_0&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/ColumnReference&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nchar&quot; Length=&quot;4&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;ConstExpr1047&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nvarchar&quot; Length=&quot;8000&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;@_msparam_1&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/ColumnReference&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nchar&quot; Length=&quot;4&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;ConstExpr1048&quot;&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;nvarchar&quot; Length=&quot;8000&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;@_msparam_2&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/ColumnReference&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/IndexScan&gt;&lt;/RelOp&gt;&lt;/ComputeScalar&gt;&lt;/RelOp&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;has_access(&#39;AO&#39;,[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id])=(1)&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;has_access&quot;&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;AO&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/Filter&gt;&lt;/RelOp&gt;&lt;RelOp NodeId=&quot;16&quot; PhysicalOp=&quot;Filter&quot; LogicalOp=&quot;Filter&quot; EstimateRows=&quot;2513.41&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0178105&quot; AvgRowSize=&quot;4039&quot; EstimatedTotalSubtreeCost=&quot;0.0625051&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;454&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Filter StartupExpression=&quot;0&quot;&gt;&lt;RelOp NodeId=&quot;17&quot; PhysicalOp=&quot;Compute Scalar&quot; LogicalOp=&quot;Compute Scalar&quot; EstimateRows=&quot;2513.41&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0003029&quot; AvgRowSize=&quot;4050&quot; EstimatedTotalSubtreeCost=&quot;0.0446946&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pid&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1054&quot;/&gt;&lt;/OutputList&gt;&lt;ComputeScalar&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1013&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;object_definition([SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id])&quot;&gt;&lt;Intrinsic FunctionName=&quot;object_definition&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1054&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;CONVERT_IMPLICIT(int,[SQLdmDatabase].[sys].[sysschobjs].[nsclass] as [o].[nsclass],0)&quot;&gt;&lt;Convert DataType=&quot;int&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsclass&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;RelOp NodeId=&quot;18&quot; PhysicalOp=&quot;Clustered Index Scan&quot; LogicalOp=&quot;Clustered Index Scan&quot; EstimateRows=&quot;2513.41&quot; EstimateIO=&quot;0.0409028&quot; EstimateCPU=&quot;0.0034889&quot; AvgRowSize=&quot;19&quot; EstimatedTotalSubtreeCost=&quot;0.0443917&quot; TableCardinality=&quot;3029&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsclass&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pid&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;3029&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;IndexScan Ordered=&quot;1&quot; ScanDirection=&quot;FORWARD&quot; ForcedIndex=&quot;0&quot; ForceSeek=&quot;0&quot; ForceScan=&quot;0&quot; NoExpandHint=&quot;0&quot; Storage=&quot;RowStore&quot;&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;nsclass&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pid&quot;/&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;Object Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Index=&quot;[clst]&quot; Alias=&quot;[o]&quot; TableReferenceId=&quot;2&quot; IndexKind=&quot;Clustered&quot;/&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;[SQLdmDatabase].[sys].[sysschobjs].[pclass] as [o].[pclass]&amp;lt;&amp;gt;(100)&quot;&gt;&lt;Compare CompareOp=&quot;NE&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pclass&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(100)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/IndexScan&gt;&lt;/RelOp&gt;&lt;/ComputeScalar&gt;&lt;/RelOp&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;has_access(&#39;TR&#39;,[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id],[SQLdmDatabase].[sys].[sysschobjs].[pid] as [o].[pid],[Expr1054])=(1) AND [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;TR&#39; OR has_access(&#39;CO&#39;,[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id])=(1) AND ([SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;FN&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;IF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;IS&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;P&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;RF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;TF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;V&#39;) OR ([SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;D&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;R&#39;) AND [SQLdmDatabase].[sys].[sysschobjs].[pid] as [o].[pid]=(0)&quot;&gt;&lt;Logical Operation=&quot;OR&quot;&gt;&lt;ScalarOperator&gt;&lt;Logical Operation=&quot;AND&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;has_access&quot;&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;TR&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pid&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Column=&quot;Expr1054&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;TR&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Logical Operation=&quot;AND&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;has_access&quot;&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;CO&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Logical Operation=&quot;OR&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;FN&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;IF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;IS&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;P&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;RF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;TF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;V&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Logical Operation=&quot;AND&quot;&gt;&lt;ScalarOperator&gt;&lt;Logical Operation=&quot;OR&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;D&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;R&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;pid&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(0)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/Filter&gt;&lt;/RelOp&gt;&lt;/Merge&gt;&lt;/RelOp&gt;&lt;RelOp NodeId=&quot;26&quot; PhysicalOp=&quot;Compute Scalar&quot; LogicalOp=&quot;Compute Scalar&quot; EstimateRows=&quot;2408&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.0002408&quot; AvgRowSize=&quot;4039&quot; EstimatedTotalSubtreeCost=&quot;0.0542647&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Column=&quot;Expr1029&quot;/&gt;&lt;/OutputList&gt;&lt;ComputeScalar&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Column=&quot;Expr1029&quot;/&gt;&lt;ScalarOperator ScalarString=&quot;object_definition([SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id])&quot;&gt;&lt;Intrinsic FunctionName=&quot;object_definition&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;RelOp NodeId=&quot;27&quot; PhysicalOp=&quot;Filter&quot; LogicalOp=&quot;Filter&quot; EstimateRows=&quot;2408&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;0.00963222&quot; AvgRowSize=&quot;11&quot; EstimatedTotalSubtreeCost=&quot;0.0540239&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;1857&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Filter StartupExpression=&quot;0&quot;&gt;&lt;RelOp NodeId=&quot;28&quot; PhysicalOp=&quot;Clustered Index Scan&quot; LogicalOp=&quot;Clustered Index Scan&quot; EstimateRows=&quot;2408&quot; EstimateIO=&quot;0.0409028&quot; EstimateCPU=&quot;0.0034889&quot; AvgRowSize=&quot;13&quot; EstimatedTotalSubtreeCost=&quot;0.0443917&quot; TableCardinality=&quot;3029&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;0&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;2408&quot; ActualEndOfScans=&quot;1&quot; ActualExecutions=&quot;1&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;IndexScan Ordered=&quot;1&quot; ScanDirection=&quot;FORWARD&quot; ForcedIndex=&quot;0&quot; ForceSeek=&quot;0&quot; ForceScan=&quot;0&quot; NoExpandHint=&quot;0&quot; Storage=&quot;RowStore&quot;&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;Object Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Index=&quot;[clst]&quot; Alias=&quot;[o]&quot; TableReferenceId=&quot;3&quot; IndexKind=&quot;Clustered&quot;/&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;[SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;FN&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;IF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;IS&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;P&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;RF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;TF&#39; OR [SQLdmDatabase].[sys].[sysschobjs].[type] as [o].[type]=&#39;V&#39;&quot;&gt;&lt;Logical Operation=&quot;OR&quot;&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;FN&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;IF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;IS&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;P&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;RF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;TF&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;type&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;V&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Logical&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/IndexScan&gt;&lt;/RelOp&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;has_access(&#39;SO&#39;,[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id])=(1)&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;has_access&quot;&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;SO&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/Filter&gt;&lt;/RelOp&gt;&lt;/ComputeScalar&gt;&lt;/RelOp&gt;&lt;/Merge&gt;&lt;/RelOp&gt;&lt;RelOp NodeId=&quot;35&quot; PhysicalOp=&quot;Filter&quot; LogicalOp=&quot;Filter&quot; EstimateRows=&quot;1&quot; EstimateIO=&quot;0&quot; EstimateCPU=&quot;9.8e-007&quot; AvgRowSize=&quot;11&quot; EstimatedTotalSubtreeCost=&quot;0.0832541&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;502.703&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;0&quot; ActualEndOfScans=&quot;439&quot; ActualExecutions=&quot;439&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;Filter StartupExpression=&quot;0&quot;&gt;&lt;RelOp NodeId=&quot;36&quot; PhysicalOp=&quot;Clustered Index Seek&quot; LogicalOp=&quot;Clustered Index Seek&quot; EstimateRows=&quot;1&quot; EstimateIO=&quot;0.003125&quot; EstimateCPU=&quot;0.0001581&quot; AvgRowSize=&quot;12&quot; EstimatedTotalSubtreeCost=&quot;0.0827604&quot; TableCardinality=&quot;0&quot; Parallel=&quot;0&quot; EstimateRebinds=&quot;502.703&quot; EstimateRewinds=&quot;0&quot; EstimatedExecutionMode=&quot;Row&quot;&gt;&lt;OutputList&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;class&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;/OutputList&gt;&lt;RunTimeInformation&gt;&lt;RunTimeCountersPerThread Thread=&quot;0&quot; ActualRows=&quot;0&quot; ActualEndOfScans=&quot;439&quot; ActualExecutions=&quot;439&quot;/&gt;&lt;/RunTimeInformation&gt;&lt;IndexScan Ordered=&quot;1&quot; ScanDirection=&quot;FORWARD&quot; ForcedIndex=&quot;0&quot; ForceSeek=&quot;0&quot; ForceScan=&quot;0&quot; NoExpandHint=&quot;0&quot; Storage=&quot;RowStore&quot;&gt;&lt;DefinedValues&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;class&quot;/&gt;&lt;/DefinedValue&gt;&lt;DefinedValue&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;/DefinedValue&gt;&lt;/DefinedValues&gt;&lt;Object Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Index=&quot;[clust]&quot; Alias=&quot;[p]&quot; IndexKind=&quot;Clustered&quot;/&gt;&lt;SeekPredicates&gt;&lt;SeekPredicateNew&gt;&lt;SeekKeys&gt;&lt;Prefix ScanType=&quot;EQ&quot;&gt;&lt;RangeColumns&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;class&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;subid&quot;/&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;name&quot;/&gt;&lt;/RangeColumns&gt;&lt;RangeExpressions&gt;&lt;ScalarOperator ScalarString=&quot;(1)&quot;&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator ScalarString=&quot;[SQLdmDatabase].[sys].[sysschobjs].[id] as [o].[id]&quot;&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysschobjs]&quot; Alias=&quot;[o]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator ScalarString=&quot;(0)&quot;&gt;&lt;Const ConstValue=&quot;(0)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator ScalarString=&quot;N&#39;microsoft_database_tools_support&#39;&quot;&gt;&lt;Const ConstValue=&quot;N&#39;microsoft_database_tools_support&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/RangeExpressions&gt;&lt;/Prefix&gt;&lt;/SeekKeys&gt;&lt;/SeekPredicateNew&gt;&lt;/SeekPredicates&gt;&lt;/IndexScan&gt;&lt;/RelOp&gt;&lt;Predicate&gt;&lt;ScalarOperator ScalarString=&quot;has_access(&#39;EP&#39;,CONVERT_IMPLICIT(int,[SQLdmDatabase].[sys].[sysxprops].[class] as [p].[class],0),[SQLdmDatabase].[sys].[sysxprops].[id] as [p].[id])=(1)&quot;&gt;&lt;Compare CompareOp=&quot;EQ&quot;&gt;&lt;ScalarOperator&gt;&lt;Intrinsic FunctionName=&quot;has_access&quot;&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&#39;EP&#39;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Convert DataType=&quot;int&quot; Style=&quot;0&quot; Implicit=&quot;1&quot;&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;class&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;/Convert&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Identifier&gt;&lt;ColumnReference Database=&quot;[SQLdmDatabase]&quot; Schema=&quot;[sys]&quot; Table=&quot;[sysxprops]&quot; Alias=&quot;[p]&quot; Column=&quot;id&quot;/&gt;&lt;/Identifier&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Intrinsic&gt;&lt;/ScalarOperator&gt;&lt;ScalarOperator&gt;&lt;Const ConstValue=&quot;(1)&quot;/&gt;&lt;/ScalarOperator&gt;&lt;/Compare&gt;&lt;/ScalarOperator&gt;&lt;/Predicate&gt;&lt;/Filter&gt;&lt;/RelOp&gt;&lt;/NestedLoops&gt;&lt;/RelOp&gt;&lt;/ComputeScalar&gt;&lt;/RelOp&gt;&lt;/Sort&gt;&lt;/RelOp&gt;&lt;ParameterList&gt;&lt;ColumnReference Column=&quot;@_msparam_2&quot; ParameterCompiledValue=&quot;N&#39;PC&#39;&quot; ParameterRuntimeValue=&quot;N&#39;PC&#39;&quot;/&gt;&lt;ColumnReference Column=&quot;@_msparam_1&quot; ParameterCompiledValue=&quot;N&#39;RF&#39;&quot; ParameterRuntimeValue=&quot;N&#39;RF&#39;&quot;/&gt;&lt;ColumnReference Column=&quot;@_msparam_0&quot; ParameterCompiledValue=&quot;N&#39;P&#39;&quot; ParameterRuntimeValue=&quot;N&#39;P&#39;&quot;/&gt;&lt;/ParameterList&gt;&lt;/QueryPlan&gt;&lt;/StmtSimple&gt;&lt;/Statements&gt;&lt;/Batch&gt;&lt;/BatchSequence&gt;&lt;/ShowPlanXML&gt;";

		// Decode escaped XML string

		if (xmlPlan != null) {
			xmlPlan = StringEscapeUtils.unescapeXml(xmlPlan);

			final InputSource src = new InputSource(new StringReader(xmlPlan));
			final Node document = DocumentBuilderFactory.newInstance()
					.newDocumentBuilder().parse(src).getDocumentElement();

			final DOMImplementationRegistry registry = DOMImplementationRegistry
					.newInstance();
			final DOMImplementationLS impl = (DOMImplementationLS) registry
					.getDOMImplementation("LS");
			final LSSerializer writer = impl.createLSSerializer();

			writer.getDomConfig().setParameter("format-pretty-print",
					Boolean.TRUE);

			xmlPlan = writer.writeToString(document);

			code.setValue(xmlPlan);
		}
		else {
			
			String noDataString = ELFunctions
					.getMessage(SQLdmI18NStrings.QUERY_PLAN_DATA_NOT_AVAILABLE);
			code.setValue(noDataString);

		}


	}

	public String getXmlPlan() {
		return xmlPlan;
	}

	public void setXmlPlan(String xmlPlan) {
		this.xmlPlan = xmlPlan;
	}

	@Listen("onClick = #exportLink")
	public void exportToXml() {

		final InputSource src = new InputSource(new StringReader(xmlPlan));
		Node document;
		try {
			document = DocumentBuilderFactory.newInstance()
					.newDocumentBuilder().parse(src).getDocumentElement();

			// Format xml
			DOMImplementationRegistry registry = DOMImplementationRegistry
					.newInstance();
			DOMImplementationLS impl = (DOMImplementationLS) registry
					.getDOMImplementation("LS");
			LSSerializer writer = impl.createLSSerializer();
			writer.getDomConfig().setParameter("format-pretty-print",
					Boolean.TRUE);

			LSOutput lsOutput = impl.createLSOutput();
			lsOutput.setEncoding("UTF-8");

			Writer stringWriter = new StringWriter();
			lsOutput.setCharacterStream(stringWriter);

			writer.write(document, lsOutput);
			String xmlString = stringWriter.toString();

			xmlString = StringEscapeUtils.unescapeXml(xmlString);

			AMedia amedia = new AMedia("QueryPlanXML.xml", "xml", "text/xml",
					xmlString);
			Filedownload.save(amedia);

		} catch (Exception e) {
			e.printStackTrace();
		}
	}

}